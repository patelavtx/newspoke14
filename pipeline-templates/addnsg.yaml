stages:
- stage: add_rule
  jobs:
  - job: validate
    continueOnError: false
    steps:
    - task: TerraformInstaller@0
      displayName: 'install'
      inputs:
        terraformVersion: '1.2.0'
      #Azure KEY Vault
    - task: AzureKeyVault@1
      inputs:
        ConnectedServiceName: $(service_name)
        KeyVaultName: $(key_vault_name)
        SecretsFilter: '*'
        RunAsPreJob: false 
    - deployment: add_sg_rule
      continueOnError: false
      environment: 'spoke14-kv'
      strategy:
        runOnce:
          deploy:
           steps:
             - task: AzureCLI@2
               displayName: 'set nsg'
               inputs:
                  azureSubscription: 'atulavtx-sst2'
                  scriptType: 'bash'
                  scriptLocation: 'inlineScript'
                  inlineScript: 'az network nsg rule create --name deploy14 --nsg-name $(controller-nsg) --priority 114 --resource-group $(controller-rg) --access Allow --protocol ''*'' --source-address-prefixes 86.20.255.82 --destination-port-ranges 80 443'
   
